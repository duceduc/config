####################################################
#                                                                                                    
#                      SERVER MONITOR                                                     
#                                                                                                    
####################################################

  - sensor:
      - name: Server Status
        unique_id: eaa5f24c-8708-467b-b139-a1108f59d2e7
        state: >-
          {% if expand('group.server_status') | selectattr('state', 'eq', 'off') | list | count >= 1 %}
            {% set sensor = expand('group.server_status') | selectattr('state', 'eq', 'off') | sort(attribute='last_changed') | last %}
              {% if sensor.name == sensor.name %}
                {{ sensor.name }}
              {% endif %}
          {% else %}
            on
          {% endif %}
        icon: >-
          {% if is_state('sensor.server_status', 'on') %}
            mdi:server-network
          {% else %}
            mdi:server-network-off
          {% endif %}


      - name: monitor rpi zero
        state: >
          {% if is_state("sensor.ms1_wifi_strength", "unavailable") or
                     is_state("sensor.ms2_wifi_strength", "unavailable") or
                     is_state("sensor.ms3_wifi_strength", "unavailable") %} on
          {% else %} off {% endif %}

      - name: monitor broadlink
        state: >
          {% if is_state("remote.rm31_remote", "unavailable") or
                     is_state("remote.rm32_remote", "unavailable") or
                     is_state("remote.rm4_remote", "unavailable") %} on
          {% else %} off {% endif %}


####################################################
#                                                                                                    
#                      SYSTEM MONITOR                                                      
#                                                                                                    
####################################################

      - name: desktop 3l5pa48 storage c gb
        unit_of_measurement: 'GB'
        state: >
          {% if state_attr('sensor.desktop_3l5pa48_storage_c', 'UsedSpaceMB')| int(0) < 1024 %}
            {{state_attr('sensor.desktop_3l5pa48_storage_c', 'UsedSpaceMB') }}
          {% else %}
            {{ '%.1f'|format(state_attr('sensor.desktop_3l5pa48_storage_c', 'UsedSpaceMB')|float / 1024) }}
          {% endif %}



####################################################
#                                                                                                    
#            END OF CONFIGURATION FILE                                                 
#                                                                                                    
####################################################
